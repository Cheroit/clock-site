<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" content="#f8f9fa">
    <title>Часы с именами</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* CSS Reset и базовые стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Default colors - will be overridden by Telegram theme */
            --bg-color: var(--tg-theme-bg-color, #f8f9fa);
            --text-color: var(--tg-theme-text-color, #2c3e50);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #2481cc);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg-color: var(--tg-theme-secondary-bg-color, #ffffff);
            --border-color: #e9ecef;
            --hover-color: #e3f2fd;
            --active-color: #bbdefb;
            --button-bg: var(--secondary-bg-color);
            --button-border: var(--border-color);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.2s ease, color 0.2s ease;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 0 1rem;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            margin-top: 1rem;
        }

        .btn {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            color: var(--text-color);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s ease;
            min-height: 48px;
            min-width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--hint-color);
        }

        .btn:hover {
            background: var(--hover-color);
            box-shadow: var(--shadow-hover);
        }

        .btn:focus {
            outline: 2px solid var(--active-color);
            outline-offset: 2px;
        }

        .clock-container {
            position: relative;
            width: min(95vw, 400px);
            height: min(95vw, 400px);
            max-width: 400px;
            max-height: 400px;
        }

        .clock-svg {
            width: 100%;
            height: 100%;
            cursor: pointer;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));
        }

        .clock-face {
            fill: url(#clockGradient);
            stroke: var(--border-color);
            stroke-width: 3;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        }

        .clock-inner {
            fill: var(--button-bg);
            stroke: var(--border-color);
            stroke-width: 2;
        }

        .hour-segment {
            fill: transparent;
            stroke: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.7;
        }

        .hour-segment-hit {
            fill: transparent;
            stroke: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        .hour-segment-hit:hover {
            opacity: 0.1;
        }

        .hour-segment:hover {
            opacity: 0.8;
        }

        .hour-segment:focus {
            outline: none;
            opacity: 0.9;
        }

        .hour-segment.active {
            opacity: 1;
        }


        .hour-line {
            stroke: var(--text-color);
            stroke-width: 2;
            opacity: 0.3;
        }

        .hour-line-major {
            stroke: var(--text-color);
            stroke-width: 3;
            opacity: 0.6;
        }

        .hour-number {
            fill: var(--text-color);
            font-size: 14px;
            font-weight: 700;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: all;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
            letter-spacing: 0.2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .hour-number:hover {
            fill: var(--active-color);
            font-size: 15px;
            font-weight: 800;
            filter: drop-shadow(0 0 8px var(--active-color)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .hour-number:focus {
            fill: var(--active-color);
            font-size: 15px;
            font-weight: 800;
            filter: drop-shadow(0 0 8px var(--active-color)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            outline: none;
        }

        .hour-number.active {
            fill: var(--active-color);
            font-size: 16px;
            font-weight: 900;
            filter: drop-shadow(0 0 12px var(--active-color)) drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
        }


        .hour-text {
            fill: var(--text-color);
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            max-width: 60px;
            opacity: 0.95;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
            letter-spacing: 0.3px;
        }

        /* Стили для внешних меток с именами */
        .name-label {
            position: absolute;
            background: var(--button-bg);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-color);
            text-align: center;
            min-width: 60px;
            max-width: 120px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8);
        }

        .name-label.show {
            opacity: 1;
            transform: scale(1);
        }

        .name-label:hover {
            box-shadow: var(--shadow-hover);
            transform: scale(1.05);
        }

        /* Стрелка от метки к циферблату */
        .name-label::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 5px solid transparent;
        }

        /* Стрелки для разных позиций */
        .name-label[data-position="top"]::before {
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-top-color: var(--border-color);
        }

        .name-label[data-position="right"]::before {
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-right-color: var(--border-color);
        }

        .name-label[data-position="bottom"]::before {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-bottom-color: var(--border-color);
        }

        .name-label[data-position="left"]::before {
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-left-color: var(--border-color);
        }

        /* Специальные позиции для углов */
        .name-label[data-position="top-right"]::before {
            bottom: -10px;
            left: 20%;
            transform: translateX(-50%);
            border-top-color: var(--border-color);
        }

        .name-label[data-position="top-left"]::before {
            bottom: -10px;
            right: 20%;
            transform: translateX(50%);
            border-top-color: var(--border-color);
        }

        .name-label[data-position="bottom-right"]::before {
            top: -10px;
            left: 20%;
            transform: translateX(-50%);
            border-bottom-color: var(--border-color);
        }

        .name-label[data-position="bottom-left"]::before {
            top: -10px;
            right: 20%;
            transform: translateX(50%);
            border-bottom-color: var(--border-color);
        }

        .center-dot {
            fill: url(#centerGradient);
            r: 5;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
        }

        .center-ring {
            fill: none;
            stroke: var(--text-color);
            stroke-width: 3;
            opacity: 0.4;
            filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.2));
        }

        .minute-marks {
            stroke: var(--text-color);
            stroke-width: 1;
            opacity: 0.15;
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
        }

        .minute-marks-major {
            stroke: var(--text-color);
            stroke-width: 2;
            opacity: 0.3;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.15));
        }

        /* Дополнительные эффекты для реалистичности */
        .clock-svg:hover .hour-segment {
            opacity: 0.8;
        }

        .clock-svg:hover .hour-number {
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.2));
        }

        /* Анимация появления элементов */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .hour-segment {
            animation: fadeInScale 0.5s ease-out;
        }

        .hour-number {
            animation: fadeInScale 0.6s ease-out;
        }

        .hour-text {
            animation: fadeInScale 0.7s ease-out;
        }

        .input-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .name-input {
            position: absolute;
            background: var(--button-bg);
            border: 2px solid var(--active-color);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 12px;
            font-family: inherit;
            color: var(--text-color);
            max-width: 80px;
            text-align: center;
            pointer-events: all;
            z-index: 20;
            box-shadow: var(--shadow);
        }

        .name-input:focus {
            outline: none;
            box-shadow: var(--shadow-hover);
        }

        .tooltip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow-hover);
            z-index: 1000;
            text-align: center;
            max-width: 300px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-text {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .tooltip-close {
            background: var(--active-color);
            border: none;
            color: var(--text-color);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            pointer-events: all;
        }

        /* Адаптивность для мобильных устройств */
        @media (max-width: 480px) {
            .container {
                gap: 1rem;
                padding: 0.5rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .title {
                font-size: 1.25rem;
            }

            .controls {
                justify-content: center;
            }

            .clock-container {
                width: min(90vw, 350px);
                height: min(90vw, 350px);
            }

            .hour-text {
                font-size: 11px;
                max-width: 50px;
            }

            .name-input {
                max-width: 80px;
                font-size: 12px;
                padding: 0.5rem;
                border-radius: 6px;
            }

            .name-label {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
                min-width: 60px;
                max-width: 120px;
            }
        }

        /* Поддержка поворота экрана */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                flex-direction: row;
                gap: 2rem;
                max-width: 100%;
            }

            .header {
                flex-direction: column;
                width: auto;
            }

            .clock-container {
                width: min(60vh, 300px);
                height: min(60vh, 300px);
            }
        }

        /* Улучшения для iOS Safari */
        @supports (-webkit-touch-callout: none) {
            .name-input {
                -webkit-appearance: none;
                appearance: none;
                border-radius: 6px;
            }

            .btn {
                -webkit-tap-highlight-color: transparent;
            }

            .hour-segment, .hour-segment-hit, .hour-number {
                -webkit-tap-highlight-color: transparent;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">English clock</h1>
        </div>
        
        <div class="controls">
            <button class="btn" id="resetBtn" aria-label="Сбросить все имена" disabled>Сбросить</button>
            <button class="btn" id="sendBtn" aria-label="Отправить имена в Telegram" style="display: none;">Отправить</button>
        </div>

        <div class="clock-container">
            <svg class="clock-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <!-- Градиенты -->
                <defs>
                    <radialGradient id="clockGradient" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" style="stop-color:var(--button-bg);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:var(--border-color);stop-opacity:0.1" />
                    </radialGradient>
                    <radialGradient id="centerGradient" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" style="stop-color:var(--text-color);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:var(--text-color);stop-opacity:0.7" />
                    </radialGradient>
                </defs>
                
                <!-- Внешний круг циферблата -->
                <circle class="clock-face" cx="100" cy="100" r="95"/>
                
                <!-- Внутренний круг -->
                <circle class="clock-inner" cx="100" cy="100" r="55"/>
                
                <!-- Минутные метки -->
                <g id="minuteMarks">
                    <!-- Метки будут созданы динамически -->
                </g>
                
                <!-- Часовые сегменты и линии -->
                <g id="hourSegments">
                    <!-- Сегменты будут созданы динамически -->
                </g>
                
                <!-- Часовые числа -->
                <g id="hourNumbers">
                    <!-- Числа будут созданы динамически -->
                </g>
                
                <!-- Тексты имен -->
                <g id="hourTexts">
                    <!-- Тексты будут созданы динамически -->
                </g>
                
                <!-- Центральная точка с кольцом -->
                <circle class="center-ring" cx="100" cy="100" r="8"/>
                <circle class="center-dot" cx="100" cy="100" r="4"/>
            </svg>
            
            <!-- Оверлей для инпутов -->
            <div class="input-overlay" id="inputOverlay"></div>
        </div>
    </div>

    <!-- Подсказка -->
    <div class="tooltip" id="tooltip">
        <div class="tooltip-text">Нажмите на часовой сегмент, чтобы ввести имя</div>
        <button class="tooltip-close" id="tooltipClose">Понятно</button>
    </div>

    <script>
        /**
         * Часы с именами - Минималистичное SPA приложение
         * 
         * Функциональность:
         * - 12-часовой циферблат с возможностью назначения имен
         * - Сохранение данных в localStorage
         * - Поддержка светлой/темной темы
         * - Адаптивный дизайн для мобильных устройств
         * - Полная поддержка доступности
         * 
         * Запуск: просто откройте index.html в браузере
         */

        class ClockApp {
            constructor() {
                this.names = {};
                this.activeSegment = null;
                this.inputElement = null;
                this.tooltipShown = false;
                
                this.init();
            }

            init() {
                this.initTelegram();
                this.loadData();
                this.createClock();
                this.bindEvents();
                this.showTooltipIfNeeded();
            }

            // Инициализация Telegram WebApp
            initTelegram() {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    
                    // Инициализируем WebApp
                    tg.ready();
                    
                    // Применяем тему из Telegram
                    this.applyTelegramTheme();
                    
                    // Слушаем изменения темы
                    tg.onEvent('themeChanged', () => {
                        this.applyTelegramTheme();
                    });
                    
                    // Развернуть WebApp на весь экран
                    tg.expand();
                    
                    // Отключить кнопку назад
                    tg.BackButton.hide();
                    
                    // Показать кнопку отправки данных в Telegram
                    const sendBtn = document.getElementById('sendBtn');
                    if (sendBtn) {
                        sendBtn.style.display = 'flex';
                    }
                }
            }

            // Применение темы Telegram
            applyTelegramTheme() {
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.themeParams) {
                    const themeParams = window.Telegram.WebApp.themeParams;
                    const root = document.documentElement;
                    
                    // Устанавливаем CSS переменные для Telegram темы
                    if (themeParams.bg_color) {
                        root.style.setProperty('--tg-theme-bg-color', themeParams.bg_color);
                    }
                    if (themeParams.text_color) {
                        root.style.setProperty('--tg-theme-text-color', themeParams.text_color);
                    }
                    if (themeParams.hint_color) {
                        root.style.setProperty('--tg-theme-hint-color', themeParams.hint_color);
                    }
                    if (themeParams.button_color) {
                        root.style.setProperty('--tg-theme-button-color', themeParams.button_color);
                    }
                    if (themeParams.button_text_color) {
                        root.style.setProperty('--tg-theme-button-text-color', themeParams.button_text_color);
                    }
                    if (themeParams.secondary_bg_color) {
                        root.style.setProperty('--tg-theme-secondary-bg-color', themeParams.secondary_bg_color);
                    }
                    
                    // Обновляем theme-color мета тег
                    const metaThemeColor = document.querySelector('meta[name="theme-color"]');
                    if (metaThemeColor && themeParams.bg_color) {
                        metaThemeColor.setAttribute('content', themeParams.bg_color);
                    }
                }
            }

            // Загрузка данных из localStorage
            loadData() {
                const saved = localStorage.getItem('clockApp');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.names = data.names || {};
                }
            }

            // Сохранение данных в localStorage
            saveData() {
                const data = {
                    names: this.names
                };
                localStorage.setItem('clockApp', JSON.stringify(data));
            }

            // Создание SVG циферблата
            createClock() {
                const minuteMarks = document.getElementById('minuteMarks');
                const hourSegments = document.getElementById('hourSegments');
                const hourNumbers = document.getElementById('hourNumbers');
                const hourTexts = document.getElementById('hourTexts');
                
                // Очищаем существующие элементы
                minuteMarks.innerHTML = '';
                hourSegments.innerHTML = '';
                hourNumbers.innerHTML = '';
                hourTexts.innerHTML = '';
                
                // Удаляем все внешние метки
                document.querySelectorAll('.name-label').forEach(label => label.remove());

                const centerX = 100;
                const centerY = 100;
                const radius = 85;
                const innerRadius = 60;

                // Создаем минутные метки
                for (let minute = 0; minute < 60; minute++) {
                    const angle = (minute - 15) * (Math.PI / 30); // Начинаем с 12 часов
                    const isMajor = minute % 5 === 0;
                    const markLength = isMajor ? 8 : 4;
                    const markRadius = radius + 5;
                    
                    const x1 = centerX + Math.cos(angle) * (markRadius - markLength);
                    const y1 = centerY + Math.sin(angle) * (markRadius - markLength);
                    const x2 = centerX + Math.cos(angle) * markRadius;
                    const y2 = centerY + Math.sin(angle) * markRadius;

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('class', isMajor ? 'minute-marks-major' : 'minute-marks');
                    minuteMarks.appendChild(line);
                }

                // Создаем часовые элементы
                for (let hour = 1; hour <= 12; hour++) {
                    const angle = (hour - 3) * (Math.PI / 6); // Начинаем с 12 часов
                    const x1 = centerX + Math.cos(angle) * innerRadius;
                    const y1 = centerY + Math.sin(angle) * innerRadius;
                    const x2 = centerX + Math.cos(angle) * radius;
                    const y2 = centerY + Math.sin(angle) * radius;

                    // Создаем большую область наведения (невидимый круг)
                    const hitArea = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    const hitRadius = radius + 20; // Увеличиваем область наведения
                    const hitX = centerX + Math.cos(angle) * (radius - 10);
                    const hitY = centerY + Math.sin(angle) * (radius - 10);
                    
                    hitArea.setAttribute('cx', hitX);
                    hitArea.setAttribute('cy', hitY);
                    hitArea.setAttribute('r', hitRadius / 3);
                    hitArea.setAttribute('class', 'hour-segment-hit');
                    hitArea.setAttribute('data-hour', hour);
                    hitArea.setAttribute('tabindex', '0');
                    hitArea.setAttribute('role', 'button');
                    hitArea.setAttribute('aria-label', `Час ${hour}. ${this.names[hour] || 'Без имени'}`);
                    
                    hourSegments.appendChild(hitArea);

                    // Создаем визуальный сегмент (кликабельную область)
                    const segment = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const startAngle = angle - Math.PI / 12;
                    const endAngle = angle + Math.PI / 12;
                    
                    const pathData = this.createSegmentPath(centerX, centerY, innerRadius, radius, startAngle, endAngle);
                    segment.setAttribute('d', pathData);
                    segment.setAttribute('class', 'hour-segment');
                    segment.setAttribute('data-hour', hour);
                    segment.setAttribute('tabindex', '0');
                    segment.setAttribute('role', 'button');
                    segment.setAttribute('aria-label', `Час ${hour}. ${this.names[hour] || 'Без имени'}`);
                    
                    hourSegments.appendChild(segment);

                    // Создаем часовую линию (только для основных часов)
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('class', 'hour-line-major');
                    hourSegments.appendChild(line);

                    // Создаем часовое число
                    const numberX = centerX + Math.cos(angle) * (radius + 8);
                    const numberY = centerY + Math.sin(angle) * (radius + 8);
                    
                    const number = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    number.setAttribute('x', numberX);
                    number.setAttribute('y', numberY);
                    number.setAttribute('class', 'hour-number');
                    number.setAttribute('data-hour', hour);
                    number.setAttribute('tabindex', '0');
                    number.setAttribute('role', 'button');
                    number.setAttribute('aria-label', `Час ${hour}. ${this.names[hour] || 'Без имени'}`);
                    number.textContent = hour;
                    hourNumbers.appendChild(number);

                    // Создаем внешнюю метку с именем (если есть)
                    if (this.names[hour]) {
                        this.createNameLabel(hour, angle, centerX, centerY, radius);
                    }
                }
            }

            // Создание внешней метки с именем
            createNameLabel(hour, angle, centerX, centerY, radius) {
                const clockContainer = document.querySelector('.clock-container');
                
                // Позиционируем метку за пределами циферблата
                const labelDistance = radius + 35; // Оптимальное расстояние - не слишком близко, не слишком далеко
                const labelX = centerX + Math.cos(angle) * labelDistance;
                const labelY = centerY + Math.sin(angle) * labelDistance;
                
                // Определяем позицию стрелки метки
                let position = 'top';
                if (angle >= -Math.PI/6 && angle < Math.PI/6) position = 'right';
                else if (angle >= Math.PI/6 && angle < Math.PI/3) position = 'bottom-right';
                else if (angle >= Math.PI/3 && angle < 2*Math.PI/3) position = 'bottom';
                else if (angle >= 2*Math.PI/3 && angle < 5*Math.PI/6) position = 'bottom-left';
                else if (angle >= 5*Math.PI/6 || angle < -5*Math.PI/6) position = 'left';
                else if (angle >= -5*Math.PI/6 && angle < -2*Math.PI/3) position = 'top-left';
                else if (angle >= -2*Math.PI/3 && angle < -Math.PI/3) position = 'top';
                else if (angle >= -Math.PI/3 && angle < -Math.PI/6) position = 'top-right';
                
                const label = document.createElement('div');
                label.className = 'name-label show';
                label.setAttribute('data-hour', hour);
                label.setAttribute('data-position', position);
                label.textContent = this.names[hour];
                
                // Позиционируем метку относительно контейнера циферблата
                const clockRect = clockContainer.getBoundingClientRect();
                const scaleX = clockRect.width / 200; // 200 - это viewBox width
                const scaleY = clockRect.height / 200; // 200 - это viewBox height
                
                const actualX = labelX * scaleX;
                const actualY = labelY * scaleY;
                
                label.style.left = `${actualX - 30}px`;
                label.style.top = `${actualY - 15}px`;
                
                clockContainer.appendChild(label);
            }

            // Создание пути для сегмента
            createSegmentPath(centerX, centerY, innerRadius, outerRadius, startAngle, endAngle) {
                const x1 = centerX + Math.cos(startAngle) * innerRadius;
                const y1 = centerY + Math.sin(startAngle) * innerRadius;
                const x2 = centerX + Math.cos(endAngle) * innerRadius;
                const y2 = centerY + Math.sin(endAngle) * innerRadius;
                const x3 = centerX + Math.cos(endAngle) * outerRadius;
                const y3 = centerY + Math.sin(endAngle) * outerRadius;
                const x4 = centerX + Math.cos(startAngle) * outerRadius;
                const y4 = centerY + Math.sin(startAngle) * outerRadius;

                return `M ${x1} ${y1} L ${x2} ${y2} L ${x3} ${y3} L ${x4} ${y4} Z`;
            }

            // Привязка событий
            bindEvents() {
                // Клики по сегментам и цифрам
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('hour-segment') || 
                        e.target.classList.contains('hour-segment-hit') ||
                        e.target.classList.contains('hour-number')) {
                        this.editSegment(e.target);
                    }
                });

                // Клавиатурные события
                document.addEventListener('keydown', (e) => {
                    if ((e.target.classList.contains('hour-segment') || 
                         e.target.classList.contains('hour-segment-hit') ||
                         e.target.classList.contains('hour-number')) && 
                        (e.key === 'Enter' || e.key === ' ')) {
                        e.preventDefault();
                        this.editSegment(e.target);
                    }
                });

                // Кнопка сброса отключена
                const resetBtn = document.getElementById('resetBtn');
                resetBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Кнопка отключена для предотвращения очистки данных
                });

                // Кнопка отправки в Telegram
                const sendBtn = document.getElementById('sendBtn');
                sendBtn.addEventListener('click', () => {
                    this.sendDataToTelegram();
                });

                // Закрытие подсказки
                document.getElementById('tooltipClose').addEventListener('click', () => {
                    this.hideTooltip();
                });

                // Закрытие подсказки по клику вне её
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.tooltip')) {
                        this.hideTooltip();
                    }
                });
            }

            // Редактирование сегмента
            editSegment(segment) {
                const hour = parseInt(segment.getAttribute('data-hour'));
                this.activeSegment = segment;
                
                // Убираем активный класс с других цифр
                document.querySelectorAll('.hour-number').forEach(s => s.classList.remove('active'));

                // Добавляем активный класс к соответствующей цифре
                const number = document.querySelector(`.hour-number[data-hour="${hour}"]`);
                if (number) {
                    number.classList.add('active');
                }

                // Создаем инпут
                this.createInput(hour);
            }

            // Создание инпута для редактирования
            createInput(hour) {
                // Удаляем существующий инпут
                if (this.inputElement) {
                    this.inputElement.remove();
                }

                const segment = document.querySelector(`[data-hour="${hour}"]`);
                const rect = segment.getBoundingClientRect();
                const clockRect = document.querySelector('.clock-container').getBoundingClientRect();
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'name-input';
                input.value = this.names[hour] || '';
                input.maxLength = 20;
                input.placeholder = 'Введите имя';
                
                // Позиционируем инпут
                const centerX = clockRect.left + clockRect.width / 2;
                const centerY = clockRect.top + clockRect.height / 2;
                const angle = (hour - 3) * (Math.PI / 6);
                const textX = centerX + Math.cos(angle) * 72.5;
                const textY = centerY + Math.sin(angle) * 72.5;
                
                input.style.left = `${textX - 40}px`;
                input.style.top = `${textY - 10}px`;
                
                document.getElementById('inputOverlay').appendChild(input);
                this.inputElement = input;
                
                // Фокусируем и выделяем текст
                input.focus();
                input.select();

                // Обработчики событий инпута
                input.addEventListener('blur', () => {
                    this.saveName(hour, input.value.trim());
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.saveName(hour, input.value.trim());
                    } else if (e.key === 'Escape') {
                        this.cancelEdit();
                    }
                });

                // Прокрутка к видимой области на мобильных устройствах
                if (window.innerWidth <= 768) {
                    setTimeout(() => {
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }

            // Сохранение имени
            saveName(hour, name) {
                if (name) {
                    this.names[hour] = name;
                } else {
                    delete this.names[hour];
                }
                
                this.updateDisplay(hour);
                this.saveData();
                this.cancelEdit();
            }

            // Отмена редактирования
            cancelEdit() {
                if (this.inputElement) {
                    this.inputElement.remove();
                    this.inputElement = null;
                }
                
                if (this.activeSegment) {
                    const hour = parseInt(this.activeSegment.getAttribute('data-hour'));
                    document.querySelectorAll('.hour-number').forEach(s => s.classList.remove('active'));
                    this.activeSegment = null;
                }
            }

            // Обновление отображения
            updateDisplay(hour) {
                // Удаляем существующую метку
                const existingLabel = document.querySelector(`.name-label[data-hour="${hour}"]`);
                if (existingLabel) {
                    existingLabel.remove();
                }
                
                // Создаем новую метку, если есть имя
                if (this.names[hour]) {
                    const angle = (hour - 3) * (Math.PI / 6);
                    const centerX = 100;
                    const centerY = 100;
                    const radius = 85;
                    this.createNameLabel(hour, angle, centerX, centerY, radius);
                }
                
                // Обновляем aria-label
                const segments = document.querySelectorAll(`[data-hour="${hour}"]`);
                segments.forEach(segment => {
                    segment.setAttribute('aria-label', `Час ${hour}. ${this.names[hour] || 'Без имени'}`);
                });
            }

            // Показ подсказки при первом запуске
            showTooltipIfNeeded() {
                const hasNames = Object.keys(this.names).length > 0;
                if (!hasNames && !this.tooltipShown) {
                    setTimeout(() => {
                        document.getElementById('tooltip').classList.add('show');
                        this.tooltipShown = true;
                    }, 1000);
                }
            }

            // Скрытие подсказки
            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }

            // Отправка данных в Telegram
            sendDataToTelegram() {
                if (window.Telegram && window.Telegram.WebApp) {
                    const namesCount = Object.keys(this.names).length;
                    if (namesCount === 0) {
                        // Показываем уведомление пользователю
                        const tooltip = document.getElementById('tooltip');
                        const tooltipText = tooltip.querySelector('.tooltip-text');
                        tooltipText.textContent = 'Добавьте имена на часы перед отправкой!';
                        tooltip.classList.add('show');
                        setTimeout(() => tooltip.classList.remove('show'), 3000);
                        return;
                    }
                    
                    // Подготавливаем данные для отправки
                    const dataToSend = {
                        names: this.names,
                        timestamp: new Date().toISOString(),
                        totalNames: namesCount
                    };
                    
                    try {
                        window.Telegram.WebApp.sendData(JSON.stringify(dataToSend));
                    } catch (error) {
                        console.error('Ошибка отправки данных в Telegram:', error);
                    }
                } else {
                    // Если не в Telegram, показываем уведомление
                    const tooltip = document.getElementById('tooltip');
                    const tooltipText = tooltip.querySelector('.tooltip-text');
                    tooltipText.textContent = 'Эта функция доступна только в Telegram WebApp';
                    tooltip.classList.add('show');
                    setTimeout(() => tooltip.classList.remove('show'), 3000);
                }
            }
        }

        // Инициализация приложения при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            window.clockApp = new ClockApp();
        });

        // Обработка изменения ориентации экрана и размера окна
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                // Пересоздаем циферблат для корректного отображения
                const app = window.clockApp;
                if (app) {
                    app.createClock();
                    // Пересоздаем все метки с именами
                    for (let hour = 1; hour <= 12; hour++) {
                        if (app.names[hour]) {
                            const angle = (hour - 3) * (Math.PI / 6);
                            app.createNameLabel(hour, angle, 100, 100, 85);
                        }
                    }
                }
            }, 100);
        });

        // Обработка изменения размера окна
        window.addEventListener('resize', () => {
            setTimeout(() => {
                const app = window.clockApp;
                if (app) {
                    // Пересоздаем все метки с именами при изменении размера
                    document.querySelectorAll('.name-label').forEach(label => label.remove());
                    for (let hour = 1; hour <= 12; hour++) {
                        if (app.names[hour]) {
                            const angle = (hour - 3) * (Math.PI / 6);
                            app.createNameLabel(hour, angle, 100, 100, 85);
                        }
                    }
                }
            }, 100);
        });
    </script>
</body>
</html>
